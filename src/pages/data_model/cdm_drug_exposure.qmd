
## DRUG_EXPOSURE

### OMOP CDM 5.4 - OMOP.DRUG_EXPOSURE
This table captures records about the exposure to a Drug ingested or otherwise introduced into the body. A Drug is a biochemical substance formulated in such a way that when administered to a Person it will exert a certain biochemical effect on the metabolism. Drugs include prescription and over-the-counter medicines, vaccines, and large-molecule biologic therapies. Radiological devices ingested or applied locally do not count as Drugs.
```{mermaid}
---
title: OMOP.DRUG_EXPOSURE
---
erDiagram
    DRUG_EXPOSURE {
        drug_exposure_id integer "[PK not null] autogenerated identifier"
        person_id integer "[FK not null]"
        drug_concept_id integer "[not null] standard OMOP concept id used for analyses, contains strength/dose info"
        drug_exposure_start_date date "[not null]"
        drug_exposure_start_datetime timestamp
        drug_exposure_end_date date "[not null]"
        drug_exposure_end_datetime timestamp
        verbatim_end_date date
        drug_type_concept_id integer "[not null] e.g. prescriptions / dispensed / patient reported"
        stop_reason varchar20 "reason for stopping as per source"
        refills integer
        quantity float "any numerical value for amount of drug"
        days_supply integer
        sig varcharMAX "verbatim instructions for drug"
        route_concept_id integer "standard omop concept id in route domain"
        lot_number varchar50
        provider_id integer "[FK] clinician provider who recorded condition"
        visit_occurrence_id integer "[FK]"
        visit_detail_id integer "[FK]"
        drug_source_value varchar50 "drug code as represented in source"
        drug_source_concept_id integer "source mapped to omop but often left empty"
        route_source_value varchar50 "verbatim route given in source"
        dose_unit_source_value varchar50 "verbatim units given in source"
    }
```

### IMPLEMENTATION - SILVER.DRUG_EXPOSURE

SILVER.DRUG_EXPOSURE is the cleaned and transformed version of ingested drug prescription, administration and/or dispensing tables, that are used to stage vanilla OMOP CDM 5.4 tables (as well as other GOLD transformations). This table is wider than the OMOP data model, and includes the following differences:

- Standardised concept codes/names are surfaced, and indexed, to enable user-friendly exploration and visualisation without the need for large joins;
- Source concept codes/names are surfaced to enable direct visibility over semantic provenance;
- Dose information from source NHS inpatient drug adminstration systems (or 'drug charts') are difficult to represent unambiguously in OMOP. For example, OMOP quantity may contain 'number of tablets' OR 'dose' OR 'total dosage given'. In the NHS, administration records found in drug charts are often a drug name (e.g. Paracetamol) and a dose (e.g. 1g) without any information about medication formulation or strength, which is the preferred information held in a standard OMOP concept. SILVER.DRUG_EXPOSURE therefore explicitly differentiates between item strength and quantity, and prescribed/administered dose.
- SILVER.DRUG_EXPOSURE also includes a column to indicate whether a prescribed dose was administered at the time, or if the dose was 'not given' at the prescribed time. 
- Each row holds information about a single concept relative to a single person. We can therefore incorporate additional, NHS-specific, information about table and systems provenance relative to source data. By extension, this allows for additional understanding of context of data generation, whereas it is often necessary to infer 'OMOP drug type'.
- OMOP CDM 5.4 columns that are not relevant to the NHS, or to intended purposes, are initialised, but set as null, and remain empty when carried into OMOP.

```{mermaid}
---
title: SILVER.DRUG_EXPOSURE
---
erDiagram
    DRUG_EXPOSURE {
        drug_exposure_id integer "[PK not null] autogenerated identifier"
        person_id integer "[FK not null]"
        drug_concept_id integer "[not null] standard OMOP concept id used for analyses, contains strength/dose info"
        drug_concept_code varchar50 "[NEW] standard OMOP concept code"
        drug_concept_name varcharMAX "[NEW] standard OMOP concept name"
        drug_concept_vocabulary_id varchar20 "[FK NEW] OMOP vocabulary id representing the standard concept"        
        drug_exposure_start_date date "[not null]"
        drug_exposure_start_datetime timestamp
        drug_exposure_end_date date "[not null]"
        drug_exposure_end_datetime timestamp
        verbatim_end_date date "[set as null]"
        drug_type_concept_id integer "[not null] e.g. prescriptions / dispensed / patient reported"
        stop_reason varchar20 "[set as null]"
        refills integer "[set as null]"
        quantity float "any numerical value for amount of drug"
        quantity_type varchar50 "[NEW] indicates what type of quantity is indicated"
        quantity_unit varchar50 "[NEW] clean version of unit for the quantity"
        dose_administration_flag varchar50 "[NEW] for EPMA, indicates whether the drug was administered (yes/no/na)"        
        days_supply integer "[set as null]"
        sig varcharMAX "[set as null]"
        route_concept_id integer "standard omop concept id in route domain"
        lot_number varchar50 "[set as null]"
        provider_id integer "[set as null]"
        visit_occurrence_id integer "[FK]"
        visit_detail_id integer "[set as null]"
        drug_source_value varchar50 "drug code as represented in source"
        drug_source_value_name varcharMAX "[NEW] drug name as represented in source"        
        drug_source_concept_id integer "[set as null]"
        dose_source_value float "[NEW] verbatim drug dose for each administration given in source"
        dose_unit_source_value varchar50 "verbatim units given in source"
        route_source_value varchar50 "verbatim route given in source"
        source_system_provenance varchar50 "[NEW] name of specific system from which source table was ingested"
        source_table_provenance varchar50 "[NEW] source table name"
        source_row_id varchar50 "[NEW] unique row id for the single concept that is generated at ingestion"        
    }
```


### ADDITIONAL NOTES

None for now!

### OUTSTANDING ISSUES

None for now!

### VERSION TRACKING

_JZ 2024-July-15_: initial version, loaded original omop table and suggested SILVER model.